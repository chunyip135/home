<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Samuel Wong | Project 1 : Image Classification</title>
  <meta property="og:title" content="Samuel Wong | Project 1 : Image Classification" />
  <meta property="og:image" content="https://example.com/img/profile_pic.jpeg" />
  <meta name="description" content="This is a project that uses Convolutional Neural Nets to classified images between classes of forest, glacier, sea, street and buildings. The libraries that are used are such as tensorflow, keras, matplotlib and numpy. The datasets is open-source and can be found on Kaggle.">
  <meta property="og:description" content="This is a project that uses Convolutional Neural Nets to classified images between classes of forest, glacier, sea, street and buildings. The libraries that are used are such as tensorflow, keras, matplotlib and numpy. The datasets is open-source and can be found on Kaggle." />
  <meta name="author" content="Samuel Wong">
  
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css"></noscript>
  
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap"></noscript>
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
      <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap"></noscript>
  <link rel="preload" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css"></noscript>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css"></noscript>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.min.css"></noscript>
  
  <link rel="preload" href="https://example.com/css/resume.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://example.com/css/resume.css"></noscript>
  <link rel="preload" href="https://example.com/css/tweaks.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://example.com/css/tweaks.css"></noscript>
  <link rel="preload" href="https://example.com/css/resume-override.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://example.com/css/resume-override.css"></noscript>
  <meta name="generator" content="Hugo 0.74.3" />
  
   
  
</head>
<body id="page-top">
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
  <a class="navbar-brand js-scroll-trigger" href="#page-top">
    <span class="d-block d-lg-none">Samuel Wong</span>
    <span class="d-none d-lg-block">
      <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="https://example.com/img/profile_pic.jpeg" alt="">
    </span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link js-scroll-trigger" href="https://example.com/#about">About</a>
      </li>
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="https://example.com/#skills">Skills</a>
          </li>
      
      
      
      
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="https://example.com/#education">Education</a>
          </li>
      
      
    </ul>
  </div>
</nav>

  <div class="container-fluid p-0">
    
<nav aria-label="breadcrumb">
  <ol  class="breadcrumb">
    







<li class="breadcrumb-item">
  <a href="https://example.com/">Home</a>
</li>


<li class="breadcrumb-item">
  <a href="https://example.com/projects/">Projects</a>
</li>


<li class="breadcrumb-item">
  <a href="https://example.com/projects/creations/">Projects</a>
</li>


<li class="breadcrumb-item active">
  <a href="https://example.com/projects/creations/cnn-notebook_commited/">Project 1 : Image Classification</a>
</li>

  </ol>
</nav>




<section class="resume-section p-3 p-lg-5 d-flex d-column">
  <div class="my-auto">
    <h2 class="mb-0"><span class="text-primary">Project 1 : Image Classification</span></h2>
    <h1 id="descriptions">Descriptions</h1>
<p>This is a project that uses Convolutional Neural Nets to classified images between classes of forest, glacier, sea, street and buildings. The libraries that are used are such as tensorflow, keras, matplotlib and numpy. The datasets is open-source and can be found on Kaggle.</p>
<ul>
<li>visualize images</li>
<li>visualize covnets</li>
<li>model</li>
<li>deploy to web</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> tensorflow <span style="color:#f92672">as</span> tf
<span style="color:#f92672">from</span> tensorflow <span style="color:#f92672">import</span> keras
<span style="color:#f92672">import</span> cv2
<span style="color:#f92672">import</span> os
<span style="color:#f92672">from</span> tensorflow.keras.preprocessing.image <span style="color:#f92672">import</span> ImageDataGenerator
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">os<span style="color:#f92672">.</span>listdir(<span style="color:#e6db74">&#34;../input/intel-image-classification/seg_train/seg_train&#34;</span>)
</code></pre></div><pre><code>['glacier', 'sea', 'forest', 'street', 'mountain', 'buildings']
</code></pre>
<h1 id="import-images-using-generator">Import images using generator</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">train_datagen <span style="color:#f92672">=</span> ImageDataGenerator(rescale <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.</span><span style="color:#f92672">/</span><span style="color:#ae81ff">255</span>)
test_datagen <span style="color:#f92672">=</span> ImageDataGenerator(rescale <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.</span><span style="color:#f92672">/</span><span style="color:#ae81ff">255</span>)
train_generator <span style="color:#f92672">=</span> train_datagen<span style="color:#f92672">.</span>flow_from_directory(<span style="color:#e6db74">&#39;../input/intel-image-classification/seg_train/seg_train&#39;</span>, target_size <span style="color:#f92672">=</span> (<span style="color:#ae81ff">150</span>,<span style="color:#ae81ff">150</span>), batch_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">128</span>,class_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sparse&#39;</span>)
test_generator <span style="color:#f92672">=</span> test_datagen<span style="color:#f92672">.</span>flow_from_directory(<span style="color:#e6db74">&#39;../input/intel-image-classification/seg_test/seg_test&#39;</span>, target_size <span style="color:#f92672">=</span> (<span style="color:#ae81ff">150</span>,<span style="color:#ae81ff">150</span>), batch_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">128</span>,class_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sparse&#39;</span>)
</code></pre></div><pre><code>Found 14034 images belonging to 6 classes.
Found 3000 images belonging to 6 classes.
</code></pre>
<h1 id="import-images-for-eda-purposes">Import images for EDA purposes</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_images</span>(directory):
    Images <span style="color:#f92672">=</span> []
    Labels <span style="color:#f92672">=</span> []  
    label <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">for</span> labels <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(directory): <span style="color:#75715e">#Main Directory where each class label is present as folder name.</span>
        <span style="color:#66d9ef">if</span> labels <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;glacier&#39;</span>: <span style="color:#75715e">#Folder contain Glacier Images get the &#39;2&#39; class label.</span>
            label <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
        <span style="color:#66d9ef">elif</span> labels <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;sea&#39;</span>:
            label <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
        <span style="color:#66d9ef">elif</span> labels <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;buildings&#39;</span>:
            label <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        <span style="color:#66d9ef">elif</span> labels <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;forest&#39;</span>:
            label <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        <span style="color:#66d9ef">elif</span> labels <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;street&#39;</span>:
            label <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
        <span style="color:#66d9ef">elif</span> labels <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;mountain&#39;</span>:
            label <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>

        <span style="color:#66d9ef">for</span> image_file <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(directory<span style="color:#f92672">+</span>labels): <span style="color:#75715e">#Extracting the file name of the image from Class Label folder</span>
            image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(directory<span style="color:#f92672">+</span>labels<span style="color:#f92672">+</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;/&#39;</span><span style="color:#f92672">+</span>image_file) <span style="color:#75715e">#Reading the image (OpenCV)</span>
            image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(image,(<span style="color:#ae81ff">150</span>,<span style="color:#ae81ff">150</span>)) <span style="color:#75715e">#Resize the image, Some images are different sizes. (Resizing is very Important)</span>
            Images<span style="color:#f92672">.</span>append(image)
            Labels<span style="color:#f92672">.</span>append(label)

    <span style="color:#66d9ef">return</span> Images, Labels
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_classlabel</span>(class_code):
    labels <span style="color:#f92672">=</span> {<span style="color:#ae81ff">2</span>:<span style="color:#e6db74">&#39;glacier&#39;</span>, <span style="color:#ae81ff">4</span>:<span style="color:#e6db74">&#39;sea&#39;</span>, <span style="color:#ae81ff">0</span>:<span style="color:#e6db74">&#39;buildings&#39;</span>, <span style="color:#ae81ff">1</span>:<span style="color:#e6db74">&#39;forest&#39;</span>, <span style="color:#ae81ff">5</span>:<span style="color:#e6db74">&#39;street&#39;</span>, <span style="color:#ae81ff">3</span>:<span style="color:#e6db74">&#39;mountain&#39;</span>}

    <span style="color:#66d9ef">return</span> labels[class_code]
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">images, labels <span style="color:#f92672">=</span> get_images(<span style="color:#e6db74">&#39;../input/intel-image-classification/seg_train/seg_train/&#39;</span>) <span style="color:#75715e">#Extract the training images from the folders.</span>

images <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(images) <span style="color:#75715e">#converting the list of images to numpy array.</span>
labels <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(labels)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Shape of images : &#39;</span>,images<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Shape of labels : &#39;</span>,labels<span style="color:#f92672">.</span>shape)
</code></pre></div><pre><code>Shape of images :  (14034, 150, 150, 3)
Shape of labels :  (14034,)
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">images[<span style="color:#ae81ff">0</span>]
</code></pre></div><pre><code>array([[[159, 142, 123],
        [158, 141, 122],
        [157, 140, 121],
        ...,
        [171, 155, 143],
        [172, 156, 144],
        [172, 156, 144]],

       [[154, 137, 118],
        [155, 138, 119],
        [157, 140, 121],
        ...,
        [172, 156, 144],
        [172, 156, 144],
        [172, 156, 144]],

       [[153, 136, 117],
        [154, 137, 118],
        [156, 139, 120],
        ...,
        [172, 156, 144],
        [172, 156, 144],
        [172, 156, 144]],

       ...,

       [[  4,  15,  13],
        [  6,  17,  15],
        [  6,  17,  15],
        ...,
        [  4,  14,   8],
        [ 36,  43,  38],
        [ 17,  24,  19]],

       [[  4,  15,  13],
        [  3,  14,  12],
        [  3,  14,  12],
        ...,
        [ 26,  40,  36],
        [ 26,  37,  34],
        [ 48,  57,  54]],

       [[  0,   6,   4],
        [  0,   4,   2],
        [  0,   9,   7],
        ...,
        [  8,  23,  19],
        [ 19,  30,  27],
        [ 14,  25,  22]]], dtype=uint8)
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">num_classes <span style="color:#f92672">=</span> len(np<span style="color:#f92672">.</span>unique(labels))
</code></pre></div><h1 id="visualize-the-images">Visualize the images</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">_, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">5</span>, figsize <span style="color:#f92672">=</span> (<span style="color:#ae81ff">15</span>,<span style="color:#ae81ff">10</span>))
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
        r <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(len(images)) <span style="color:#75715e"># randomly select 25 images</span>
        ax[i,j]<span style="color:#f92672">.</span>imshow(images[r])
        ax[i,j]<span style="color:#f92672">.</span>set_title(get_classlabel(labels[r]))
        ax[i,j]<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;off&#39;</span>)

plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#39;cnn.png&#39;</span>)
</code></pre></div><p><img src="https://example.com/post/cnn-notebook_commited_files/cnn-notebook_commited_13_0.png" alt="png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">_, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots()
pd<span style="color:#f92672">.</span>Series(labels)<span style="color:#f92672">.</span>map({<span style="color:#ae81ff">2</span>:<span style="color:#e6db74">&#39;glacier&#39;</span>, <span style="color:#ae81ff">4</span>:<span style="color:#e6db74">&#39;sea&#39;</span>, <span style="color:#ae81ff">0</span>:<span style="color:#e6db74">&#39;buildings&#39;</span>, <span style="color:#ae81ff">1</span>:<span style="color:#e6db74">&#39;forest&#39;</span>, <span style="color:#ae81ff">5</span>:<span style="color:#e6db74">&#39;street&#39;</span>, <span style="color:#ae81ff">3</span>:<span style="color:#e6db74">&#39;mountain&#39;</span>})<span style="color:#f92672">.</span>value_counts()<span style="color:#f92672">.</span>sort_index()<span style="color:#f92672">.</span>plot(kind <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;bar&#39;</span>,ax<span style="color:#f92672">=</span>ax)
</code></pre></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f1b5a7594d0&gt;
</code></pre>
<p><img src="https://example.com/post/cnn-notebook_commited_files/cnn-notebook_commited_14_1.png" alt="png"></p>
<h1 id="model">Model</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">myCallback</span>(keras<span style="color:#f92672">.</span>callbacks<span style="color:#f92672">.</span>Callback):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_epoch_end</span>(self, epoch, logs<span style="color:#f92672">=</span>{}):
        <span style="color:#66d9ef">if</span>(logs<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;acc&#39;</span>)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0.85</span>):
          <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Reached 85% accuracy so cancelling training!&#34;</span>)
          self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>stop_training <span style="color:#f92672">=</span> True

callbacks <span style="color:#f92672">=</span> myCallback()
model <span style="color:#f92672">=</span> keras<span style="color:#f92672">.</span>models<span style="color:#f92672">.</span>Sequential([
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Conv2D(<span style="color:#ae81ff">64</span>, (<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>), activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>, input_shape<span style="color:#f92672">=</span>(<span style="color:#ae81ff">150</span>,<span style="color:#ae81ff">150</span>,<span style="color:#ae81ff">3</span>)),
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>MaxPooling2D(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>),
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Conv2D(<span style="color:#ae81ff">64</span>, (<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>), activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>),
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>MaxPooling2D(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>),
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Conv2D(<span style="color:#ae81ff">32</span>, (<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>), activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>),
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>MaxPooling2D(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>),
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Conv2D(<span style="color:#ae81ff">16</span>, (<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>), activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>),
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>MaxPooling2D(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>),
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Flatten(),
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Dense(<span style="color:#ae81ff">128</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>),
    keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Dense(num_classes, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;softmax&#39;</span>)
])

model<span style="color:#f92672">.</span>summary()
</code></pre></div><pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d (Conv2D)              (None, 148, 148, 64)      1792      
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 74, 74, 64)        0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 72, 72, 64)        36928     
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 36, 36, 64)        0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 34, 34, 32)        18464     
_________________________________________________________________
max_pooling2d_2 (MaxPooling2 (None, 17, 17, 32)        0         
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 15, 15, 16)        4624      
_________________________________________________________________
max_pooling2d_3 (MaxPooling2 (None, 7, 7, 16)          0         
_________________________________________________________________
flatten (Flatten)            (None, 784)               0         
_________________________________________________________________
dense (Dense)                (None, 128)               100480    
_________________________________________________________________
dense_1 (Dense)              (None, 6)                 774       
=================================================================
Total params: 163,062
Trainable params: 163,062
Non-trainable params: 0
_________________________________________________________________
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">model<span style="color:#f92672">.</span>compile(loss <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sparse_categorical_crossentropy&#39;</span>, optimizer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Adam&#39;</span>, metrics <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;acc&#39;</span>])
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">history <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>fit(train_generator,validation_data <span style="color:#f92672">=</span> test_generator, epochs <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>,callbacks <span style="color:#f92672">=</span> [callbacks], batch_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">128</span>)
</code></pre></div><pre><code>Epoch 1/20
110/110 [==============================] - 35s 315ms/step - loss: 1.1974 - acc: 0.5186 - val_loss: 1.0111 - val_acc: 0.6160
Epoch 2/20
110/110 [==============================] - 30s 272ms/step - loss: 0.8693 - acc: 0.6699 - val_loss: 0.8058 - val_acc: 0.6900
Epoch 3/20
110/110 [==============================] - 29s 265ms/step - loss: 0.7290 - acc: 0.7280 - val_loss: 0.7573 - val_acc: 0.7153
Epoch 4/20
110/110 [==============================] - 30s 275ms/step - loss: 0.6485 - acc: 0.7634 - val_loss: 0.6422 - val_acc: 0.7553
Epoch 5/20
110/110 [==============================] - 28s 257ms/step - loss: 0.5823 - acc: 0.7911 - val_loss: 0.5794 - val_acc: 0.7937
Epoch 6/20
110/110 [==============================] - 29s 268ms/step - loss: 0.5351 - acc: 0.8071 - val_loss: 0.5537 - val_acc: 0.8057
Epoch 7/20
110/110 [==============================] - 28s 259ms/step - loss: 0.5152 - acc: 0.8100 - val_loss: 0.5237 - val_acc: 0.8127
Epoch 8/20
110/110 [==============================] - 30s 269ms/step - loss: 0.4737 - acc: 0.8287 - val_loss: 0.4953 - val_acc: 0.8217
Epoch 9/20
110/110 [==============================] - 29s 267ms/step - loss: 0.4361 - acc: 0.8421 - val_loss: 0.5356 - val_acc: 0.8133
Epoch 10/20
110/110 [==============================] - 30s 274ms/step - loss: 0.4354 - acc: 0.8404 - val_loss: 0.6009 - val_acc: 0.7787
Epoch 11/20
110/110 [==============================] - 29s 265ms/step - loss: 0.4193 - acc: 0.8487 - val_loss: 0.5276 - val_acc: 0.8107
Epoch 12/20
110/110 [==============================] - ETA: 0s - loss: 0.3948 - acc: 0.8573
Reached 85% accuracy so cancelling training!
110/110 [==============================] - 30s 276ms/step - loss: 0.3948 - acc: 0.8573 - val_loss: 0.5287 - val_acc: 0.8037
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">score <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(history<span style="color:#f92672">.</span>history)

_, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,figsize <span style="color:#f92672">=</span> (<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">6</span>))
score[[<span style="color:#e6db74">&#39;acc&#39;</span>,<span style="color:#e6db74">&#39;val_acc&#39;</span>]]<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>ax[<span style="color:#ae81ff">0</span>])
score[[<span style="color:#e6db74">&#39;loss&#39;</span>,<span style="color:#e6db74">&#39;val_loss&#39;</span>]]<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>ax[<span style="color:#ae81ff">1</span>])
ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>set(xlabel <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;epochs&#39;</span>,ylabel <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;accuracy&#39;</span>,title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;acc &amp; valid</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">s acc&#39;</span>)
ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>set(xlabel <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;epochs&#39;</span>,ylabel <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;loss&#39;</span>,title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;loss &amp; valid</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">s loss&#39;</span>)
</code></pre></div><pre><code>[Text(0, 0.5, 'loss'),
 Text(0.5, 0, 'epochs'),
 Text(0.5, 1.0, &quot;loss &amp; valid's loss&quot;)]
</code></pre>
<p><img src="https://example.com/post/cnn-notebook_commited_files/cnn-notebook_commited_19_1.png" alt="png"></p>
<h1 id="import-images-from-pred-directory">Import images from pred directory</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">images_test, labels_test <span style="color:#f92672">=</span> get_images(<span style="color:#e6db74">&#39;../input/intel-image-classification/seg_test/seg_test/&#39;</span>) <span style="color:#75715e">#Extract the training images from the folders.</span>

images_test <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(images_test) <span style="color:#75715e">#converting the list of images to numpy array.</span>
labels_test <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(labels_test)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">random_predict_with_labels</span>():
    r <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(len(images_test))
    result <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(np<span style="color:#f92672">.</span>expand_dims(images_test[r],axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>))<span style="color:#f92672">.</span>reshape(<span style="color:#ae81ff">6</span>)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Predicted : &#39;</span>,get_classlabel(np<span style="color:#f92672">.</span>argmax(result)))
    <span style="color:#66d9ef">if</span> get_classlabel(np<span style="color:#f92672">.</span>argmax(result)) <span style="color:#f92672">==</span> get_classlabel(labels_test[r]):
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Prediction is accurate!&#39;</span>)
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Prediction is wrong! </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74"> Correct prediction is {}&#39;</span><span style="color:#f92672">.</span>format(get_classlabel(labels_test[r])))


    fig,ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,figsize <span style="color:#f92672">=</span> (<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">6</span>))
    ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>imshow(images_test[r])
    ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;off&#39;</span>)

    ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>bar(np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">6</span>), result)
    plt<span style="color:#f92672">.</span>xticks(np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">6</span>),[<span style="color:#e6db74">&#39;buildings&#39;</span>,<span style="color:#e6db74">&#39;forest&#39;</span>,<span style="color:#e6db74">&#39;glacier&#39;</span>,<span style="color:#e6db74">&#39;mountain&#39;</span>,<span style="color:#e6db74">&#39;sea&#39;</span>,<span style="color:#e6db74">&#39;street&#39;</span>], rotation <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>)
    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Probability of each class&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">random_predict_with_labels()
</code></pre></div><pre><code>Predicted :  glacier
Prediction is accurate!
</code></pre>
<p><img src="https://example.com/post/cnn-notebook_commited_files/cnn-notebook_commited_23_1.png" alt="png"></p>
<h1 id="applying-the-model-to-predict-on-preds-sets">Applying the model to predict on Pred&rsquo;s sets</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pred_image</span>(directory):
    Images <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> image_file <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(directory): <span style="color:#75715e">#Extracting the file name of the image from Class Label folder</span>
            image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(directory<span style="color:#f92672">+</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;/&#39;</span><span style="color:#f92672">+</span>image_file) <span style="color:#75715e">#Reading the image (OpenCV)</span>
            image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(image,(<span style="color:#ae81ff">150</span>,<span style="color:#ae81ff">150</span>)) <span style="color:#75715e">#Resize the image, Some images are different sizes. (Resizing is very Important)</span>
            Images<span style="color:#f92672">.</span>append(image)

    <span style="color:#66d9ef">return</span> Images

images_pred <span style="color:#f92672">=</span> pred_image(<span style="color:#e6db74">&#34;../input/intel-image-classification/seg_pred/seg_pred&#34;</span>)

images_pred <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(images_pred)

<span style="color:#66d9ef">print</span>(images_pred<span style="color:#f92672">.</span>shape)

images_pred <span style="color:#f92672">=</span> images_pred <span style="color:#f92672">/</span> <span style="color:#ae81ff">255.0</span> <span style="color:#75715e"># normalize the pixels to value between [0,1]</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">random_predict</span>():
    r <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(len(images_pred))
    result <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(np<span style="color:#f92672">.</span>expand_dims(images_pred[r],axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>))<span style="color:#f92672">.</span>reshape(<span style="color:#ae81ff">6</span>)
    <span style="color:#66d9ef">print</span>(get_classlabel(np<span style="color:#f92672">.</span>argmax(result)))


    fig,ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,figsize <span style="color:#f92672">=</span> (<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">6</span>))
    ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>imshow(images_pred[r])
    ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;off&#39;</span>)

    ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>bar(np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">6</span>), result)
    plt<span style="color:#f92672">.</span>xticks(np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">6</span>),[<span style="color:#e6db74">&#39;buildings&#39;</span>,<span style="color:#e6db74">&#39;forest&#39;</span>,<span style="color:#e6db74">&#39;glacier&#39;</span>,<span style="color:#e6db74">&#39;mountain&#39;</span>,<span style="color:#e6db74">&#39;sea&#39;</span>,<span style="color:#e6db74">&#39;street&#39;</span>], rotation <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>)
    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Probability of each class&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">random_predict()
</code></pre></div><pre><code>sea
</code></pre>
<p><img src="https://example.com/post/cnn-notebook_commited_files/cnn-notebook_commited_27_1.png" alt="png"></p>

    <p>Project link: <a href="https://github.com/eddiewebb/bosh-bamboo">https://github.com/eddiewebb/bosh-bamboo</a></p>
    <ul class="tags">
    
      <li><a class="tag" href="https://example.com/tags/python">Python</a></li>
    
      <li><a class="tag" href="https://example.com/tags/keras">keras</a></li>
    
      <li><a class="tag" href="https://example.com/tags/deep-learning">deep learning</a></li>
    
      <li><a class="tag" href="https://example.com/tags/tensorflow">tensorflow</a></li>
    
      <li><a class="tag" href="https://example.com/tags/cnn">CNN</a></li>
    
</ul>

  </div>
</section>


    <span style="color: #999999; font-size: 60%;">Nifty <a href="https://codepen.io/wbeeftink/pen/dIaDH">tech tag lists</a> fromÂ <a class="pen-owner-link" href="https://codepen.io/wbeeftink">Wouter Beeftink</a> </span>
    
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
  
  <script async src="https://example.com/js/resume.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id="></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', '');
  </script>
  

  
</body>
</html>
